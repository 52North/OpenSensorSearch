<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--

    ﻿Copyright (C) 2012
    by 52 North Initiative for Geospatial Open Source Software GmbH

    Contact: Andreas Wytzisk
    52 North Initiative for Geospatial Open Source Software GmbH
    Martin-Luther-King-Weg 24
    48155 Muenster, Germany
    info@52north.org

    This program is free software; you can redistribute and/or modify it under
    the terms of the GNU General Public License version 2 as published by the
    Free Software Foundation.

    This program is distributed WITHOUT ANY WARRANTY; even without the implied
    WARRANTY OF MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
    General Public License for more details.

    You should have received a copy of the GNU General Public License along with
    this program (see gnu-gpl v2.txt). If not, write to the Free Software
    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA or
    visit the Free Software Foundation web page, http://www.fsf.org.

-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>SIR test client</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

<link href="sir.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon"
	href="https://52north.org/templates/52n/favicon.ico" />

<script src="codemirror/codemirror.js" type="text/javascript"></script>

<script type="text/javascript">
	var datafolder = window.location.href.substring(0, window.location.href
			.lastIndexOf("/") + 1)
			+ "TestRequests/";
	var editor = null;
	var defaultString = "<!-- Insert your request here or select one of the examples from the menu above. -->";

	function load() {
		if (editor == null) {
			initEditor();
		}
		initExamples();
	}

	function initExamples() {
		var placeholderIndex = "PLACEHOLDER";
		//load files
		var requests = new Array();
		requests[1] = datafolder + "GetCapabilities.xml";
		requests[2] = placeholderIndex;
		requests[3] = datafolder + "DescribeSensor.xml";

		requests[4] = datafolder + "GetSensorStatus_bySearchCriteria.xml";
		requests[5] = datafolder + "GetSensorStatus_bySensorIDInSIR.xml";
		requests[6] = datafolder + "GetSensorStatus_byServiceDescription.xml";
		requests[7] = placeholderIndex;
		requests[8] = placeholderIndex;
		requests[9] = placeholderIndex;
		requests[10] = datafolder + "HarvestService_WeatherSOS.xml";

		requests[11] = datafolder + "InsertSensorInfo_addReference.xml";
		requests[12] = datafolder + "InsertSensorInfo_newSensor.xml";

		requests[13] = datafolder + "UpdateSensorDescription.xml";

		requests[14] = datafolder + "DeleteSensorInfo_deleteReference.xml";
		requests[15] = datafolder + "DeleteSensorInfo.xml";

		requests[16] = datafolder + "InsertSensorStatus.xml";
		requests[17] = placeholderIndex;

		requests[18] = datafolder + "SearchSensor_bySearchCriteria.xml";
		requests[19] = datafolder + "SearchSensor_bySensorIDInSIR.xml";
		requests[20] = datafolder + "SearchSensor_byServiceDescription.xml";

		requests[21] = datafolder + "ConnectToCatalog.xml";
		requests[22] = datafolder + "ConnectToCatalog_NowAndSchedulePeriod.xml";
		requests[23] = datafolder + "DisconnectFromCatalog.xml";

		//fill the select element
		var selRequest = document.getElementById("selRequest");

		l = requests.length;

		//         
		for ( var i = 0; i < l; i++) {
			//   
			var requestString = "";
			if (requests[i] == placeholderIndex) {
				//skip this one
			} else {
				try {
					var name = requests[i].substring(requests[i]
							.lastIndexOf(datafolder)
							+ datafolder.length, requests[i].length);
					selRequest.add(new Option(name, requests[i]), null);
				} catch (err) {
					var txt = "";
					txt += "Error loading file: " + requests[i];
					txt += "Error: " + err + "\n\n";
					var requestTextarea = document
							.getElementById("requestTextarea").value = "";
					requestTextarea.value += txt;
				}
			}
		}
	}

	function initEditor() {
		editor = CodeMirror.fromTextArea("requestTextarea", {
			height : "380px",
			parserfile : "parsexml.js",
			stylesheet : "codemirror/xmlcolors.css",
			path : "codemirror/",
			lineNumbers : true,
			content : defaultString
		});
	}

	function insertSelected() {
		try {
			var selObj = document.getElementById("selRequest");
			var requestString = "";

			if (selObj.selectedIndex != 0) {
				// Handle selection of empty drop down entry.
				requestString = getFile(selObj.options[selObj.selectedIndex].value);
			} else {
				requestString = defaultString;
			}

			if (requestString == null) {
				requestString = "Sorry! There is a problem with the Server, please refresh the page.";
			}

			editor.setCode(requestString);

		} catch (err) {
			var txt = "";
			txt += "Error loading file: "
					+ selObj.options[selObj.selectedIndex].value;
			txt += "Error: " + err + "\n\n";
			editor.setCode(txt);
		}
	}

	function getFile(fileName) {
		oxmlhttp = null;
		try {
			oxmlhttp = new XMLHttpRequest();
			oxmlhttp.overrideMimeType("text/xml");
		} catch (e) {
			try {
				oxmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				return null;
			}
		}
		if (!oxmlhttp)
			return null;
		try {
			oxmlhttp.open("POST", fileName, false);
			oxmlhttp.send(null);
		} catch (e) {
			return null;
		}
		return oxmlhttp.responseText;
	}
</script>

</head>
<body bgcolor="#ffffff" text="#000000" onload="load()">
	<div id="content">
		<div id="header">
			<div id="headline">
				<span class="title">SIR Basic Text Client</span><span
					class="infotext">Version 0.3</span>
				<div class="infotext">
					For more information about the Sensor Instance Registry please
					consult S. Jirka, A. Bröring and C. Stasch: <i>Discovery
						Mechanisms for the Sensor Web</i> (<a
						href="http://www.mdpi.com/1424-8220/9/4/2661"
						title="Publication Download">Open Access download</a>).
				</div>
			</div>
		</div>

		<h3>
			Request Examples:&nbsp;&nbsp;<select id="selRequest"
				onchange="insertSelected();">
				<option value=" "></option>
			</select>
		</h3>

		<div class="infotext">
			<p>
				You can change the examples in the folder <font face="monospace">[project-directory]/WebContent/TestRequests/</font>.
			</p>
		</div>

		<div class="request-form">
			<form name="requestform" method="post"
				action="${service.path}/${service.endpoint.service}">
				<div class="textareaBorder">
					<textarea name="request" id="requestTextarea" class="largeTextarea"
						rows="10" cols="10"></textarea>
				</div>
				<div class="request-form-buttons">
					<input value="Send"
						onclick="requestform.action = urlform.url.value" type="submit" />
					<input value="Clear" name="reset" type="reset"
						onclick="document.getElementById('selRequest').selectedIndex = 0; insertSelected();" />
				</div>
			</form>
			<p class="infotext">${project.build.finalName}
				${version}-r${buildNumber} as of ${buildTimestamp}</p>
			<p class="infotext">This TestClient was successfully tested in
				Firefox 3.0, Safari 4.0.3, Opera 10.10, Chrome 4.0 and
				InternetExplorer 8.0.6001.18702 and should work properly in Firefox
				1.0 or higher, Safari 1.2 or higher, Opera 8 or higher and
				InternetExplorer 5 or higher. The editor is based on CodeMirror
				(http://marijn.haverbeke.nl/codemirror/).</p>
		</div>

		<div class="center">
			<a href="http://validator.w3.org/check?uri=referer"> <img
				src="http://www.w3.org/Icons/valid-xhtml11" alt="Valid XHTML 1.1" />
			</a> <a href="http://jigsaw.w3.org/css-validator/check/referer"> <img
				src="http://jigsaw.w3.org/css-validator/images/vcss"
				alt="CSS is valid!" />
			</a>
		</div>

	</div>
</body>
</html>
